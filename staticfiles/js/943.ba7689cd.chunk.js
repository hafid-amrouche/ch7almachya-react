"use strict";(self.webpackChunkfe=self.webpackChunkfe||[]).push([[943],{2943:(e,o,t)=>{t.r(o),t.d(o,{default:()=>s});var n=t(2791),a=t(4702),r=t(5096);const s=()=>{(0,n.useEffect)((()=>{const e=(0,a.ZF)({apiKey:"AIzaSyCvQPhgNrO3VqmOLTNG-K3IIdu_n00q9u4",authDomain:"ch7al-machya-web-fcm.firebaseapp.com",projectId:"ch7al-machya-web-fcm",storageBucket:"ch7al-machya-web-fcm.appspot.com",messagingSenderId:"920203073524",appId:"1:920203073524:web:f863eb5ca537c90ea38ba1",measurementId:"G-QBKVL6V01W"}),o=(0,r.KL)(e);let t=JSON.parse(localStorage.getItem("fcmData"));window.deleteToken=()=>{(0,r.pQ)(o).then((function(){console.log("Token deleted successfully")})).catch((function(e){"messaging/token-not-found"===e.code?console.log("Token not found; it may have already been deleted."):console.error("Error deleting token:",e)}))};let n=0;const s=()=>{1==n?(setTimeout(s,1e3),n+=1):(0,r.LP)(o).then((e=>{console.log("old token:",t&&t.token,"\n","new token:",e),(e=>{const o=window.userToken,t={fcm_token:e,user_token:o},n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(t)};fetch("http://localhost:8000/api/user/update-fcm-token/",n).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{console.log(e)})).catch((e=>{console.error("There was a problem with the fetch operation:",e)}))})(e),t={fcmToken:e,lastChecked:new Date},localStorage.setItem("fcmData",JSON.stringify(t))})).catch((e=>{console.log(e),n<10&&(n+=1,setTimeout(s,1e3))}))},c=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/"}).then((e=>{console.log("Service Worker registered with scope:",e.scope);let o=()=>!t||!t.lastChecked||(new Date-new Date(t.lastChecked))/1e3>86400;const n=setInterval((()=>{"granted"===Notification.permission&&window.userToken||(clearInterval(n),window.deleteToken()),o()&&s()}),36e5);o()&&s()})).catch((e=>{console.error("Service Worker registration failed:",e)}))};"Notification"in window&&("granted"!==Notification.permission?Notification.requestPermission().then((e=>{"granted"===e?c():console.warn("Permission not granted!!!")})):c())}),[])}}}]);
//# sourceMappingURL=943.ba7689cd.chunk.js.map