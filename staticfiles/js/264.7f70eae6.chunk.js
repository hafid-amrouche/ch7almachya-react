"use strict";(self.webpackChunkfe=self.webpackChunkfe||[]).push([[264],{264:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var s=a(2791),i=a(213),l=a(2046),n=a(7689),r=a(4457),o=a(5294),m=a(8592),c=a(8255),d=a(184);const u=e=>{let{showUpdateEmail:t,setShowUpdateEmail:a,confirmEmail:n,loadingSetEmail:u,setLoadingSetEmail:x}=e;const[h,g]=(0,s.useState)(""),{userData:f,setUserData:p}=(0,s.useContext)(i.S),[j,v]=(0,s.useState)(null),N=(0,s.useRef)("/api/settings/set-email/");(0,s.useEffect)((()=>{t&&(N.current="/api/settings/update-email/",g(f.email))}),[]);const{Left:S,E:E}=(0,s.useContext)(l._),{translate:C}=(0,s.useContext)(c.O);return(0,d.jsx)("div",{className:"container mw-500",children:(0,d.jsxs)("div",{className:"card p-3 m-3",children:[j&&(0,d.jsx)(m.v,{variant:"danger",removeAlert:()=>{v(null)},className:"m-2",children:j.response.data.detail||j.message}),(0,d.jsx)("h4",{children:t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:()=>{a(!1)},className:"btn btn-outline-success",children:(0,d.jsx)("i",{className:"fa-solid fa-chevron-".concat(S)})})," ",C("Update")]}):C("Set up your email")}),(0,d.jsx)("input",{value:h,placeholder:C("Email"),onChange:e=>g(e.target.value),className:"form-control my-4 col-6"}),(0,d.jsx)("button",{disabled:!(0,r.vV)(h)||h===f.email||u,onClick:()=>{x(!0),o.Z.post(N.current,{email:h},{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+f.token}}).then((e=>{p((t=>{let a={...f,email:e.data.email,is_email_verified:!1};return localStorage.setItem("userData",JSON.stringify(a)),a})),n()})).catch((e=>{v(e),x(!1)}))},className:"btn btn-success",children:C(u?"Setting up your email...":"Set up")})]})})},x=e=>{let{confirmEmail:t,setShowUpdateEmail:a,loadingVerifyEmail:n}=e;const[m,u]=(0,s.useState)(!1),{userData:x,setUserData:h}=(0,s.useContext)(i.S),{setGlobalMessage:g,togglePopup:f}=(0,s.useContext)(l._),{translate:p}=(0,s.useContext)(c.O);return(0,d.jsx)("div",{className:"container mw-700",children:(0,d.jsxs)("div",{className:"card m-3",children:[(0,d.jsxs)("div",{className:"mx-3 mt-2",children:[(0,d.jsx)("strong",{children:p("Current email address")}),(0,d.jsx)("div",{children:(0,d.jsx)("strong",{className:"text-grey",children:x.email})}),(0,d.jsx)("div",{children:(0,d.jsx)("strong",{className:x.is_email_verified?"color-theme":"text-danger",children:x.is_email_verified?p("Verified"):p("Not verified")})})]}),(0,d.jsx)("hr",{}),!x.is_email_verified&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{className:"mx-3 enlage-hover  text-start",onClick:t,children:(0,d.jsx)("strong",{children:n?p("Sending the verification link to your email ..."):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("i",{className:"fa-solid fa-check mx-3"})," ",p("Click here to verify your email")]})})}),(0,d.jsx)("hr",{})]}),(0,d.jsxs)("button",{className:"mx-3 enlage-hover text-start",onClick:()=>a(!0),children:[(0,d.jsx)("i",{className:"fa-solid fa-pen-to-square mx-3"}),(0,d.jsx)("strong",{children:p("Update Your email")})]}),(0,d.jsx)("hr",{}),(0,d.jsxs)("button",{className:"mx-3 mb-3 text-danger enlage-hover text-start",onClick:()=>(0,r.Dd)("delete-email-question",f),children:[(0,d.jsx)("i",{className:"fa-solid fa-trash mx-3"}),(0,d.jsx)("strong",{children:p("Delete your email")})]}),(0,d.jsxs)("div",{className:"m-3",id:"delete-email-question",hidden:!0,children:[(0,d.jsx)("strong",{children:p("Are you sure you want to delete your email ?")}),(0,d.jsx)("div",{className:"mx-3 mt-3",children:(0,d.jsxs)("div",{className:"text-end",children:[(0,d.jsx)("button",{className:"btn btn-danger mx-2",onClick:()=>{u(!0),o.Z.post("/api/settings/delete-email/",{},{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+x.token}}).then((e=>{g({variant:"success",text:e.data.detail,className:"m-3"}),h((e=>{let t={...e,email:"",is_email_verified:!1};return localStorage.setItem("userData",JSON.stringify(t)),t})),u(!1)})).catch((e=>{g({variant:"danger",text:e.response.data.detail||e.message,className:"m-3"}),u(!1)}))},children:p(m?"Deleting your email ...":"Yes")}),(0,d.jsx)("button",{onClick:()=>(0,r.Dd)("delete-email-question",f),className:"btn btn-outline-success",children:p("No")})," "]})})]})]})})},h=()=>{const e=(0,s.useContext)(l._),t=(0,n.s0)(),a=window.location.href,r=new URLSearchParams(a.split("?")[1]),m=r.get("email-verified"),h=r.get("email"),{userData:g,setUserData:f}=(0,s.useContext)(i.S),{setGlobalMessage:p}=e,[j,v]=(0,s.useState)(!1),[N,S]=(0,s.useState)(!1),[E,C]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!1);(0,s.useEffect)((()=>{"true"===m?(p({variant:"success",text:'You email "'.concat(h,'" is verified'),className:"m-3"}),f((e=>{let t={...e,extention:{...e.extention,email_verified:!0}};return localStorage.setItem("userData",JSON.stringify(t)),t})),t("/settings/manage-email/")):"false"===m&&(p({variant:"danger",text:"Invalid link",className:"m-3"}),t("/settings/manage-email/"))}),[]),(0,s.useEffect)((()=>{g.email||b(!0)}),[g]);const k=()=>{v(!0),o.Z.post("/api/settings/confirm-email/",{},{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+g.token}}).then((e=>{p({variant:"success",text:e.data.detail,className:"m-3"}),C(!1),b(!1),v(!1),S(!1)})).catch((e=>{p({variant:"danger",text:e.response.data.detail||e.message,className:"m-3"}),C(!1),b(!1),v(!1),S(!1)}))},w=E||y,{translate:_}=(0,s.useContext)(c.O),{setTitle:D,setDescription:U}=(0,s.useContext)(l._);return(0,s.useEffect)((()=>{D(_("Manage Email")+" | ".concat(_("Ch7al Machya"))),U(_("description"))}),[]),(0,d.jsxs)(d.Fragment,{children:[!w&&(0,d.jsx)(x,{setLoadingSetEmail:S,loadingSetEmail:N,setShowUpdateEmail:C,confirmEmail:k,loadingVerifyEmail:j,setLoadingVerifyEmail:v}),w&&(0,d.jsx)(u,{setLoadingSetEmail:S,setShowUpdateEmail:C,loadingSetEmail:N,setShowSetUpEmail:b,confirmEmail:k,setLoadingVerifyEmail:v,showUpdateEmail:E,loadingVerifyEmail:j})]})}}}]);
//# sourceMappingURL=264.7f70eae6.chunk.js.map