"use strict";(self.webpackChunkfe=self.webpackChunkfe||[]).push([[943],{2943:(e,o,t)=>{t.r(o),t.d(o,{default:()=>s});var n=t(2791),a=t(4702),r=t(5096);const s=()=>{(0,n.useEffect)((()=>{const e=(0,a.ZF)({apiKey:"AIzaSyB0FyjOo6-j0XK8pLcH1_NWzZqq2DDT-LM",authDomain:"ch7al-machya.firebaseapp.com",projectId:"ch7al-machya",storageBucket:"ch7al-machya.appspot.com",messagingSenderId:"1006750492863",appId:"1:1006750492863:web:14de76ca115914a6c1fe0a",measurementId:"G-074VKY03K5"}),o=(0,r.KL)(e);let t=JSON.parse(localStorage.getItem("fcmData"));window.deleteToken=()=>{"ReactNativeWebView"in window&&window.ReactNativeWebView.postMessage(JSON.stringify({type:"DELETE_FCM_TOKEN"})),(0,r.pQ)(o).then((function(){console.log("Token deleted successfully")})).catch((function(e){"messaging/token-not-found"===e.code?console.log("Token not found; it may have already been deleted."):console.error("Error deleting token:",e)}))};let n=0;const s=()=>{1==n?(setTimeout(s,1e3),n+=1):(0,r.LP)(o).then((e=>{console.log("old token:",t&&t.token,"\n","new token:",e),(e=>{const o=window.location.origin+"/api/user/update-fcm-token/",t=window.userToken,n={fcm_token:e,user_token:t},a={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(n)};fetch(o,a).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{console.log(e)})).catch((e=>{console.error("There was a problem with the fetch operation:",e)}))})(e),t={fcmToken:e,lastChecked:new Date},localStorage.setItem("fcmData",JSON.stringify(t))})).catch((e=>{console.log(e),n<10&&(n+=1,setTimeout(s,1e3))}))},i=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/"}).then((e=>{console.log("Service Worker registered with scope:",e.scope);let o=()=>!t||!t.lastChecked||(new Date-new Date(t.lastChecked))/1e3>86400;const n=setInterval((()=>{"granted"===Notification.permission&&window.userToken||(clearInterval(n),window.deleteToken()),o()&&s()}),36e5);o()&&s()})).catch((e=>{console.error("Service Worker registration failed:",e)}))};"Notification"in window&&("granted"!==Notification.permission?Notification.requestPermission().then((e=>{"granted"===e?i():console.warn("Permission not granted!!!")})):i())}),[])}}}]);
//# sourceMappingURL=943.f6af9fe8.chunk.js.map